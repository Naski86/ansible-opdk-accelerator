---

- name: Setup listener
  shell: "nc -l -p {{ port }}"
  register: listener_ps
  async: 4
  poll: 0

- name: Validate port
  wait_for:
    port: "{{ port }}"
    timeout: 2
    host: "{{ private_address }}"
  delegate_to: "{{ hostvars[item]['private_address'] }}"
  with_items: "{{ groups['ds'] }}"

